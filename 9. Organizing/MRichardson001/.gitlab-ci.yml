stages:
  - uat
  - development
  - production
  
before_script:
  - az login --service-principal -u $GITLAB_CONTAINER_MANAGER_SP_USERNAME -p $GITLAB_CONTAINER_MANAGER_SP_PASSWORD --tenant $GITLAB_AZURE_TENANTID -o none 
  - az acr login --name $GITLAB_ACR_NAME --username $GITLAB_CONTAINER_MANAGER_SP_USERNAME --password $GITLAB_CONTAINER_MANAGER_SP_PASSWORD 
   
variables:
  CI_VERSION: "1.0"
  CI_VERSION_2: "1-0"
  GIT_CLONE_PATH: 'C:\GitLab-Runner\builds\$CI_JOB_ID\$CI_PROJECT_NAME' 
  GIT_CLONE_PATH_ROOT: 'C:\GitLab-Runner\builds\$CI_JOB_ID'
  DEPLOYMENT_VERSION: "1-0"
  CONTAINER_VERSION: "1.0"
  GIT_DEPTH: 120
   
build uat frontend:
  stage: uat
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Uat
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesUAT.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-uat-east
    CLIENT_NAME_CENTRAL: amlicom-uat-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://uat.amli.com
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_EAST $SERVER_BLOB_STORAGE_URL

    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_EAST $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_EAST $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_EAST
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - uat

build uat frontend only:
  stage: uat
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Uat
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesUAT.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-uat-east
    CLIENT_NAME_CENTRAL: amlicom-uat-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://uat.amli.com
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://uat.amli.com/east/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://uat.amli.com/central/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL

    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_CENTRAL $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_CENTRAL
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - uat-frontend
    
build uat graph:
  stage: uat
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Uat
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesUATData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-uat-data-east
    API_NAME_CENTRAL: amlicom-uat-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013 
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_EAST $API_EMAIL_ENDPOINT_EAST $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_EAST $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_EAST
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} 

    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - uat

build uat graph only:
  stage: uat
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Uat
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesUATData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-uat-data-east
    API_NAME_CENTRAL: amlicom-uat-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_CENTRAL $API_EMAIL_ENDPOINT_CENTRAL $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_CENTRAL $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_CENTRAL
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} 

    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - uat-graph

build development frontend:
  stage: development
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Development
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesDevelopment.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-development-east
    CLIENT_NAME_CENTRAL: amlicom-development-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://devbackend1.amli.com/
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://prod1backendeast.eastus.cloudapp.azure.com/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_EAST $SERVER_BLOB_STORAGE_URL
    
    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_EAST $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_EAST $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_EAST
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_EAST $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - development

build development frontend only:
  stage: development
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Development
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesDevelopment.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-development-east
    CLIENT_NAME_CENTRAL: amlicom-development-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://dev1.amli.com
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://prod1backendeast.eastus.cloudapp.azure.com/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL
    
    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_CENTRAL $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_CENTRAL
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - development-frontend

build development graph:
  stage: development
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Development
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesDevelopmentData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-development-data-east
    API_NAME_CENTRAL: amlicom-development-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_EAST $API_EMAIL_ENDPOINT_EAST $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_EAST $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_EAST
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} 

    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - development

build development graph only:
  stage: development
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Development
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesDevelopmentData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-development-data-east
    API_NAME_CENTRAL: amlicom-development-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID}
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_EAST $API_EMAIL_ENDPOINT_EAST $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_EAST $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_EAST
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_EAST $API_VERSION ${CI_BUILD_ID}    
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_CENTRAL $API_EMAIL_ENDPOINT_CENTRAL $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_CENTRAL $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_CENTRAL
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_EAST $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - development-graph

build production frontend:
  stage: production
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Production
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesProduction.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-production-east
    CLIENT_NAME_CENTRAL: amlicom-production-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://amli.com
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://prod1backendeast.eastus.cloudapp.azure.com/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL
    
    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_CENTRAL $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_CENTRAL
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - production

build production frontend only:
  stage: production
  variables: 
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Production
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesProduction.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    CLIENT_NAME_EAST: amlicom-production-east
    CLIENT_NAME_CENTRAL: amlicom-production-central
    CLIENT_VERSION: "1.0"
    CLIENT_DOMAIN: https://amli.com
    CLIENT_ENV: production
    SERVER_PORT: 3000
    SERVER_ENV: production
    SERVER_BLOB_STORAGE_URL: https://amlistorage.blob.core.windows.net/
    SERVER_DATA_ACCESS_EAST: https://prod1backendeast.eastus.cloudapp.azure.com/graphql
    SERVER_DATA_ACCESS_CENTRAL: https://prod1backendcentral.centralus.cloudapp.azure.com/graphql
  script:   
    - powershell -file scripts/frontend/1-1-deploymentInitialize.ps1 $CLIENT_ENV $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL
    
    - powershell -file scripts/frontend/1-2-deploymentCreateBuild.ps1 $SERVER_ENV $SERVER_PORT $CLIENT_VERSION ${CI_BUILD_ID} $SERVER_DATA_ACCESS_CENTRAL $SERVER_BLOB_STORAGE_URL $CLIENT_ENV $CLIENT_NAME_CENTRAL $CLIENT_DOMAIN $APPLICATION_STORAGE_LOCATION $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/frontend/1-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/frontend/1-5-deploymentReadDeploymentReadyStatus.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-6-deploymentReadApplicationReadyStatus.ps1 $CLIENT_NAME_CENTRAL
    - powershell -file scripts/frontend/1-7-deploymentUpdateServiceVersion.ps1 $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/frontend/1-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $CLIENT_NAME_CENTRAL $CLIENT_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - production-frontend

build production graph:
  stage: production
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Production
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesProductionData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-production-data-east
    API_NAME_CENTRAL: amlicom-production-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_CENTRAL $API_EMAIL_ENDPOINT_CENTRAL $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_CENTRAL $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_CENTRAL
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} 

    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - production

build production graph only:
  stage: production
  variables:
    APPLICATION_PACKAGING_INSTRUCTIONS: Dockerfile.Windows.Production
    APPLICATION_STORAGE_LOCATION: amlicontainers.azurecr.io 
    APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS: valuesProductionData.yaml 
    APPLICATION_CLOUD_DEPLOYMENT_REGION_EAST: AMLIKubernetesCluster-admin
    APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL: AMLIKubernetesClusterCentral-admin 
    API_NAME_EAST: amlicom-production-data-east
    API_NAME_CENTRAL: amlicom-production-data-central
    API_VERSION: "1.0"
    API_ENV: production
    API_MAIN_ENDPOINT_CENTRAL: https://amlisqlapicentral.azurewebsites.net/
    API_EMAIL_ENDPOINT_CENTRAL: https://amliemailapicentral.azurewebsites.net/
    API_REALPAGE_ENDPOINT_CENTRAL: https://amlirealpageapicentral.azurewebsites.net/
    API_ENTRATA_ENDPOINT_CENTRAL: https://amlientrataapicentral.azurewebsites.net/
    API_MAIN_ENDPOINT_EAST: https://amlisqlapieast.azurewebsites.net/
    API_EMAIL_ENDPOINT_EAST: https://amliemailapieast.azurewebsites.net/
    API_REALPAGE_ENDPOINT_EAST: https://amlirealpageapieast.azurewebsites.net/
    API_ENTRATA_ENDPOINT_EAST: https://amlientrataapieast.azurewebsites.net/
    API_PRICING_ENDPOINT: https://amlipricingapi.azurewebsites.net/
    API_PRISMIC_ENDPOINT: https://amli-website.cdn.prismic.io/api/v2
    API_AUTH_TOKEN: fdhjkhfweiuh3jkdsfasaf243sdiou7
    API_REVIEWPUSH_EMAIL: asjohnson@amli.com
    API_REVIEWPUSH_PASSWORD: amanda2013
    SERVER_PORT: 8000
    SERVER_ENV: production
  script:
    - powershell -file scripts/graph/2-1-deploymentInitialize.ps1 $API_VERSION ${CI_BUILD_ID} 
    
    - powershell -file scripts/graph/2-2-deploymentCreateBuild.ps1 $SERVER_PORT $SERVER_ENV $API_ENV $API_MAIN_ENDPOINT_CENTRAL $API_EMAIL_ENDPOINT_CENTRAL $API_PRICING_ENDPOINT $API_REALPAGE_ENDPOINT_CENTRAL $API_PRISMIC_ENDPOINT $API_AUTH_TOKEN $API_REVIEWPUSH_EMAIL $API_REVIEWPUSH_PASSWORD $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_PACKAGING_INSTRUCTIONS
    - powershell -file scripts/graph/2-3-deploymentCreateBuildPush.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-4-deploymentCreateCloudServerPush.ps1 $APPLICATION_CLOUD_DEPLOYMENT_REGION_CENTRAL $APPLICATION_CLOUD_DEPLOYMENT_INSTRUCTIONS $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $APPLICATION_STORAGE_LOCATION
    - powershell -file scripts/graph/2-5-deploymentReadDeploymentReadyStatus.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID}
    - powershell -file scripts/graph/2-6-deploymentReadApplicationReadyStatus.ps1 $API_NAME_CENTRAL
    - powershell -file scripts/graph/2-7-deploymentUpdateServiceVersion.ps1 $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} 

    - powershell -file scripts/graph/2-8-deploymentCleanup.ps1 $APPLICATION_STORAGE_LOCATION $API_NAME_CENTRAL $API_VERSION ${CI_BUILD_ID} $GIT_CLONE_PATH_ROOT
  cache:
    paths:
      - .yarn-cache
      - node_modules/
  only:
    - production-graph